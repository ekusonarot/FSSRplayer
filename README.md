# Feature Select Super Resolution (FSSR)

このディレクトリでは，修士論文の提案手法により動画を再生するプレイヤを実行できる．

論文では特に明記していないが，簡単のため提案手法を `Feature Select Super Resolution (FSSR)` と名付けて，プログラムの実行に関する説明を行う．

```
修士論文："動画配信におけるフレームの特徴量に基づく映像の超解像処理手法の提案"
```
## 実行方法
### Python3のインストール
python3の実行環境を用意する．

WindowsであればWSLのUbuntuがおススメ．UbuntuであればデフォルトでPython3がインストール済み．(インストールされていなければ，aptでインストールすること)

### 必要なパッケージのインストール
実行に必要なパッケージをインストールする．

```
sudo pip3 install -r requirements.txt
```

足りないパッケージがあれば実行時にエラーが出るので，必要に応じて追加でインストールすること．

### Xサーバのインストール(WSLによる実行時のみ)
WSL上でGUIプログラムを実行するには，Xサーバをインストールする必要がある．以下のサイトを参考に行ってもらいたい．

https://www.atmarkit.co.jp/ait/articles/1812/06/news040.html

プログラムの実行時には，Xサーバを起動しておくこと．なお，WSLは現在開発が進んでおりGUIに対応する動きがあるようなので，実行時の環境によっては必要ない可能性もある．

### 実行
現状のプログラムでは，以下の `Youtube` 上のサンプル映像から，サイズが `256x144` のものを受信して，超解像を行いながら再生する．

https://youtu.be/BBvod49uySQ

実行は，以下の通り．
```
python3 FSSRplayer.py
```

これで，前述した映像を `FSSR` により超解像しながら再生される．なお，再生された映像は `./videolog` 下に保存される．

なお，再生動画を変更したい場合には，`FSSRplayer.py` 上のURLを書き換えること．
## オプション
### パラメータの変更
修士論文に記したように，提案手法ではバッチサイズ，セグメントサイズという２つのパラメータが存在する．

バッチサイズは `-b` コマンド，セグメントサイズは `-s` コマンドでそれぞれ指定できる．デフォルトでは，バッチサイズが10，セグメントサイズが20となっている．

実行例は以下の通り．

```
python3 FSSRplayer.py -b 20 -s 30
```

### 拡大手法の変更
提案手法を含め，修士論文の評価で比較を行った３種類の手法から拡大手法を選択して再生できる．

`-m` コマンドにより指定を行う．指定できる手法は以下の表にまとめる．

|オプション値|拡大手法|
|:---:|:---:|
|FSSR|提案手法|
|NSSR|単純手法|
|BIC|バイキュービック手法|

各手法については，修士論文を参照されたい．以下に，単純手法による再生実行例を示す．
```
python3 FSSRplayer.py -m NSSR
```

### 評価の出力
`-e` コマンドにより，修士論文の評価に示した，拡大手法の変化回数および超解像枚数の評価をファイルに出力することができる．

```
python3 FSSRplayer.py -e
```

### 先頭セグメントの超解像
先頭のセグメントの超解像を行うと，再生開始までに待ち時間が生じてしまう．そこで，先頭のセグメントのみはバイキュービック手法により拡大することで再生開始を早めることが考えられる．

`-f` コマンドにより，先頭のセグメントのみバイキュービック手法で拡大が行われる．

```
python3 FSSRplayer.py -f
```

# 再生動画の評価

高解像度の正解映像を用意することで，映像の精度を評価できる．なお，サンプル映像の正解映像は `./GT` 下に用意している．

## 評価の実行
評価には `eval.py` を用い，`-i` で評価する映像のパス，`-gt` で正解映像のパスを指定することで，映像内の全フレームにおける `平均PSNR`，`平均SSIM`，`平均LPIPS` を評価できる．

## 実行例
まず，サンプル映像を提案手法により再生した映像を評価する．
```
python3 eval.py -i "./videolog/Best 1 minute INSPIRATIONAL video...|Mr.Perfect/FSSR_10ign20buftime.mp4" -gt "GT/GT_Best 1 minute INSPIRATIONAL video..._ Mr. Perfect.mp4"

```
これにより，以下の出力を得る．
```
avgPSNR  : 29.662093784972065
avgSSIM  : 0.8894433040644463
avgLPIPS : 0.16454368695232452
```

次に，サンプル映像をバイキュービック手法により再生した映像を評価する．
```
python3 eval.py -i "./videolog/Best 1 minute INSPIRATIONAL video...|Mr.Perfect/BIC.mp4" -gt "GT/GT_Best 1 minute INSPIRATIONAL video..._ Mr. Perfect.mp4"
```
これにより，以下の出力を得る．
```
avgPSNR  : 29.210967858007635
avgSSIM  : 0.8872650937945574
avgLPIPS : 0.19865970331695154
```

上記の出力を表にまとめると，以下のようになる．

|指標|FSRCNN|バイキュービック|
|:---:|:---:|:---:|
|avgPSNR|29.662|29.211|
|avgSSIM|0.889|0.887|
|avgLPIPS|0.165|0.199|

`avgPSNR` および `avgSSIM` は値が大きいほど高評価，`avgLPIPS` は値が小さいほど高評価であるため，いずれの手法においても提案手法がバイキュービック手法に比べ高精度であると分かる．

# まとめ
本ディレクトリでは，提案手法により再生するプレイヤの使用法を解説した．計算機内の映像を再生する場合や，ローカルにサーバを立てて再生する場合などについては`旧バージョン`のコードと更新ログを参考に実装してほしい．# FSSRplayer
